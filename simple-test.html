<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { margin: 10px; padding: 15px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 15px; background: #f8f9fa; border-radius: 5px; border-left: 4px solid #007bff; }
        .success { background: #d4edda; border-left-color: #28a745; }
        .error { background: #f8d7da; border-left-color: #dc3545; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîß –ü—Ä–æ—Å—Ç–∏–π —Ç–µ—Å—Ç –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–∏—Ç–∞–Ω—å</h1>
    
    <div>
        <h2>–ö—Ä–æ–∫ 1: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó</h2>
        <button onclick="checkAuth()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é</button>
        <div id="authResult"></div>
    </div>
    
    <div>
        <h2>–ö—Ä–æ–∫ 2: –¢–µ—Å—Ç –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è</h2>
        <button onclick="testSave()">–ó–±–µ—Ä–µ–≥—Ç–∏ –ø–∏—Ç–∞–Ω–Ω—è</button>
        <div id="saveResult"></div>
    </div>
    
    <div>
        <h2>–ö—Ä–æ–∫ 3: –¢–µ—Å—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</h2>
        <button onclick="testLoad()">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ</button>
        <div id="loadResult"></div>
    </div>
    
    <div>
        <h2>–ö—Ä–æ–∫ 4: –ü–æ–≤–Ω–∏–π —Ç–µ—Å—Ç</h2>
        <button onclick="runFullTest()">–ó–∞–ø—É—Å—Ç–∏—Ç–∏ –ø–æ–≤–Ω–∏–π —Ç–µ—Å—Ç</button>
        <div id="fullTestResult"></div>
    </div>

    <script>
        let userId = null;

        function addResult(containerId, message, isSuccess = true) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `result ${isSuccess ? 'success' : 'error'}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            container.appendChild(div);
            console.log(message);
        }

        async function checkAuth() {
            addResult('authResult', 'üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é...');
            
            try {
                const response = await fetch('/api/auth/me');
                const data = await response.json();
                
                if (data.user) {
                    userId = data.user.id;
                    addResult('authResult', `‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π! User ID: ${userId} (—Ç–∏–ø: ${typeof userId})`, true);
                    return true;
                } else {
                    addResult('authResult', '‚ùå –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π! –£–≤—ñ–π–¥—ñ—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É.', false);
                    return false;
                }
            } catch (error) {
                addResult('authResult', `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, false);
                return false;
            }
        }

        async function testSave() {
            if (!userId) {
                addResult('saveResult', '‚ùå –°–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é!', false);
                return;
            }

            addResult('saveResult', 'üíæ –¢–µ—Å—Ç—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–∏—Ç–∞–Ω–Ω—è...');
            
            try {
                const testData = {
                    questionId: 1,
                    notes: 'Test note from simple test'
                };
                
                addResult('saveResult', `üì§ –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –¥–∞–Ω—ñ: ${JSON.stringify(testData)}`);
                
                const response = await fetch('/api/physiology/saved', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData),
                });
                
                addResult('saveResult', `üì• –°—Ç–∞—Ç—É—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ: ${response.status}`);
                
                const data = await response.json();
                addResult('saveResult', `üìÑ –î–∞–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ: <pre>${JSON.stringify(data, null, 2)}</pre>`);
                
                if (response.ok) {
                    addResult('saveResult', '‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–µ!', true);
                } else {
                    addResult('saveResult', `‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: ${data.error}`, false);
                }
            } catch (error) {
                addResult('saveResult', `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, false);
            }
        }

        async function testLoad() {
            addResult('loadResult', 'üì• –¢–µ—Å—Ç—É—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –ø–∏—Ç–∞–Ω—å...');
            
            try {
                const response = await fetch('/api/physiology/saved');
                const data = await response.json();
                
                addResult('loadResult', `üìÑ –°—Ç–∞—Ç—É—Å: ${response.status}`);
                addResult('loadResult', `üìÑ –î–∞–Ω—ñ: <pre>${JSON.stringify(data, null, 2)}</pre>`);
                
                if (response.ok) {
                    addResult('loadResult', `‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ ${data.savedQuestions?.length || 0} –ø–∏—Ç–∞–Ω—å`, true);
                } else {
                    addResult('loadResult', `‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è: ${data.error}`, false);
                }
            } catch (error) {
                addResult('loadResult', `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, false);
            }
        }

        async function runFullTest() {
            addResult('fullTestResult', 'üöÄ –ó–∞–ø—É—Å–∫–∞—î–º–æ –ø–æ–≤–Ω–∏–π —Ç–µ—Å—Ç...');
            
            // –ö—Ä–æ–∫ 1: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
            const authOk = await checkAuth();
            if (!authOk) {
                addResult('fullTestResult', '‚ùå –¢–µ—Å—Ç –∑—É–ø–∏–Ω–µ–Ω–æ: –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π', false);
                return;
            }
            
            // –ö—Ä–æ–∫ 2: –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è
            await testSave();
            
            // –ö—Ä–æ–∫ 3: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
            await testLoad();
            
            addResult('fullTestResult', '‚úÖ –ü–æ–≤–Ω–∏–π —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ!', true);
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.onload = function() {
            addResult('authResult', 'üîÑ –°—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é"');
        };
    </script>
</body>
</html>
