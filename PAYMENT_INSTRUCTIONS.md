# üéâ Plata by Mono - –ì–æ—Ç–æ–≤–æ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è!

## ‚úÖ –©–æ –≤–∂–µ –∑—Ä–æ–±–ª–µ–Ω–æ:

### 1. –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –º–æ–¥–µ–ª—å `Payment` –≤ Prisma —Å—Ö–µ–º—ñ
- ‚úÖ –¢–∞–±–ª–∏—Ü—è `payments` —Å—Ç–≤–æ—Ä–µ–Ω–∞ –≤ Supabase
- ‚úÖ –î–æ–¥–∞–Ω–æ —ñ–Ω–¥–µ–∫—Å–∏ —Ç–∞ —Ç—Ä–∏–≥–µ—Ä–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è `updated_at`

### 2. Backend API
- ‚úÖ `/api/payments/mono/create` - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω–≤–æ–π—Å—É Monobank
- ‚úÖ `/api/payments/mono/webhook` - –æ–±—Ä–æ–±–∫–∞ callback –≤—ñ–¥ Monobank
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Å–ø—Ä–æ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –æ–ø–ª–∞—Ç–∏

### 3. Frontend
- ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ `/randomizer/buy` –∑ –∫–Ω–æ–ø–∫–∞–º–∏ –æ–ø–ª–∞—Ç–∏
- ‚úÖ –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ `PaymentModal` –¥–ª—è –ø—Ä–æ—Ü–µ—Å—É –æ–ø–ª–∞—Ç–∏
- ‚úÖ –°—Ç–æ—Ä—ñ–Ω–∫–∞ —É—Å–ø—ñ—Ö—É `/randomizer/payment/success`
- ‚úÖ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ (Dialog, Alert)

### 4. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
- ‚úÖ –ó–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è –≤ `.env.local`
- ‚úÖ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ NextAuth –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó

## üöÄ –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:

### –ö—Ä–æ–∫ 1: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ngrok (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)

–©–æ–± Monobank –º—ñ–≥ –Ω–∞–¥—Å–∏–ª–∞—Ç–∏ webhook –Ω–∞ –≤–∞—à –ª–æ–∫–∞–ª—å–Ω–∏–π —Å–µ—Ä–≤–µ—Ä, –ø–æ—Ç—Ä—ñ–±–µ–Ω ngrok:

```bash
# –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å ngrok (—è–∫—â–æ —â–µ –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ)
brew install ngrok

# –ó–∞–ø—É—Å—Ç—ñ—Ç—å ngrok –≤ –æ–∫—Ä–µ–º–æ–º—É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ
ngrok http 3000
```

–°–∫–æ–ø—ñ—é–π—Ç–µ HTTPS URL (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `https://abc123.ngrok.io`) —ñ –æ–Ω–æ–≤—ñ—Ç—å `.env.local`:

```env
MONOBANK_WEBHOOK_URL=https://abc123.ngrok.io/api/payments/mono/webhook
```

### –ö—Ä–æ–∫ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤–µ—Ä

```bash
# –ó—É–ø–∏–Ω—ñ—Ç—å –ø–æ—Ç–æ—á–Ω–∏–π —Å–µ—Ä–≤–µ—Ä (Ctrl+C)
# –ó–∞–ø—É—Å—Ç—ñ—Ç—å –∑–Ω–æ–≤—É
npm run dev
```

### –ö—Ä–æ–∫ 3: –ü—Ä–æ—Ç–µ—Å—Ç—É–π—Ç–µ –æ–ø–ª–∞—Ç—É

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ http://localhost:3000/randomizer/buy
2. –û–±–µ—Ä—ñ—Ç—å –±—É–¥—å-—è–∫–∏–π –ø–∞–∫–µ—Ç
3. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ö—É–ø–∏—Ç–∏ –∑–∞—Ä–∞–∑"
4. –£ –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –æ–ø–ª–∞—Ç–∏"
5. –í—ñ–¥–∫—Ä–∏—î—Ç—å—Å—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞ Monobank –¥–ª—è –æ–ø–ª–∞—Ç–∏

### –ö—Ä–æ–∫ 4: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü—ñ—Å–ª—è –æ–ø–ª–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ:

```bash
# –í —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ –¥–µ –∑–∞–ø—É—â–µ–Ω–æ —Å–µ—Ä–≤–µ—Ä, –ø–æ–¥–∏–≤—ñ—Ç—å—Å—è –ª–æ–≥–∏
# –í–∏ –ø–æ–≤–∏–Ω–Ω—ñ –ø–æ–±–∞—á–∏—Ç–∏:
# ‚úÖ –£—Å–ø—ñ—à–Ω–∏–π –ø–ª–∞—Ç—ñ–∂! –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á user@email.com –æ—Ç—Ä–∏–º–∞–≤ X —Å–ø—Ä–æ–±
```

## üîß –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ webhook:
```bash
curl http://localhost:3000/api/payments/mono/webhook
# –ü–æ–≤–∏–Ω–µ–Ω –ø–æ–≤–µ—Ä–Ω—É—Ç–∏: {"status":"ok","message":"Monobank webhook endpoint –ø—Ä–∞—Ü—é—î"}
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂—ñ–≤ —É –±–∞–∑—ñ –¥–∞–Ω–∏—Ö:

–ß–µ—Ä–µ–∑ Supabase SQL Editor:
```sql
-- –í—Å—ñ –ø–ª–∞—Ç–µ–∂—ñ
SELECT * FROM payments ORDER BY created_at DESC;

-- –°–ø—Ä–æ–±–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
SELECT * FROM randomizer_attempts ORDER BY created_at DESC;
```

### –õ–æ–≥–∏ –ø–æ–º–∏–ª–æ–∫:

–ü–æ–¥–∏–≤—ñ—Ç—å—Å—è –≤ –∫–æ–Ω—Å–æ–ª—ñ –±—Ä–∞—É–∑–µ—Ä–∞ —Ç–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ñ –ª–æ–≥–∏ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏.

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ payments/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ mono/
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ create/
‚îÇ   ‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ route.ts          # API –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω–≤–æ–π—Å—É
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ webhook/
‚îÇ   ‚îÇ               ‚îî‚îÄ‚îÄ route.ts          # Webhook endpoint
‚îÇ   ‚îî‚îÄ‚îÄ randomizer/
‚îÇ       ‚îú‚îÄ‚îÄ buy/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx                  # –°—Ç–æ—Ä—ñ–Ω–∫–∞ –ø–æ–∫—É–ø–∫–∏
‚îÇ       ‚îî‚îÄ‚îÄ payment/
‚îÇ           ‚îî‚îÄ‚îÄ success/
‚îÇ               ‚îî‚îÄ‚îÄ page.tsx              # –°—Ç–æ—Ä—ñ–Ω–∫–∞ —É—Å–ø—ñ—Ö—É
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ payment/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PaymentModal.tsx             # –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –æ–ø–ª–∞—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ ui/
‚îÇ       ‚îú‚îÄ‚îÄ dialog.tsx                   # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥—ñ–∞–ª–æ–≥—É
‚îÇ       ‚îî‚îÄ‚îÄ alert.tsx                    # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∞–ª–µ—Ä—Ç—ñ–≤
‚îî‚îÄ‚îÄ prisma/
    ‚îî‚îÄ‚îÄ schema.prisma                     # –°—Ö–µ–º–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
```

## üéØ –ü–∞–∫–µ—Ç–∏ Randomizer PRO

| –ü–∞–∫–µ—Ç | –°–ø—Ä–æ–± | –¶—ñ–Ω–∞ | –í–∏–≥–æ–¥–∞ |
|-------|-------|------|--------|
| –û–¥–Ω–∞ —Å–ø—Ä–æ–±–∞ | 1 | 180 ‚Ç¥ | - |
| **–ü–∞–∫–µ—Ç 5 —Å–ø—Ä–æ–±** | 5 | 650 ‚Ç¥ | –ï–∫–æ–Ω–æ–º—ñ—è 250 ‚Ç¥ |
| –ü–∞–∫–µ—Ç 10 —Å–ø—Ä–æ–± | 10 | 1450 ‚Ç¥ | –ï–∫–æ–Ω–æ–º—ñ—è 350 ‚Ç¥ |

## üîê –ë–µ–∑–ø–µ–∫–∞

- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ NextAuth
- ‚úÖ –í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ
- ‚úÖ Foreign key constraints –≤ –ë–î
- ‚úÖ HTTPS –¥–ª—è webhook (—á–µ—Ä–µ–∑ ngrok)
- ‚ö†Ô∏è –î–æ–¥–∞—Ç–∫–æ–≤–æ: –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—é –ø—ñ–¥–ø–∏—Å—É webhook

## üìä –°—Ç–∞—Ç—É—Å–∏ –ø–ª–∞—Ç–µ–∂—ñ–≤

- `pending` - –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –æ–ø–ª–∞—Ç–∏ (—Å—Ç–≤–æ—Ä–µ–Ω–æ —ñ–Ω–≤–æ–π—Å)
- `processing` - –ü–ª–∞—Ç—ñ–∂ –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è
- `success` - –ü–ª–∞—Ç—ñ–∂ —É—Å–ø—ñ—à–Ω–∏–π, —Å–ø—Ä–æ–±–∏ –¥–æ–¥–∞–Ω—ñ
- `failure` - –ü–æ–º–∏–ª–∫–∞ –ø–ª–∞—Ç–µ–∂—É
- `expired` - –¢–µ—Ä–º—ñ–Ω –æ–ø–ª–∞—Ç–∏ –º–∏–Ω—É–≤

## üêõ –í—ñ–¥–æ–º—ñ –ø—Ä–æ–±–ª–µ–º–∏ —Ç–∞ —Ä—ñ—à–µ–Ω–Ω—è

### –ü—Ä–æ–±–ª–µ–º–∞: Webhook –Ω–µ —Å–ø—Ä–∞—Ü—å–æ–≤—É—î
**–†—ñ—à–µ–Ω–Ω—è:** 
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è —â–æ ngrok –∑–∞–ø—É—â–µ–Ω–æ
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ MONOBANK_WEBHOOK_URL –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π
- –ü–æ–¥–∏–≤—ñ—Ç—å—Å—è –ª–æ–≥–∏ –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–ª–∞—Ç—ñ–∂ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è, –∞–ª–µ —Å–ø—Ä–æ–±–∏ –Ω–µ –¥–æ–¥–∞—é—Ç—å—Å—è
**–†—ñ—à–µ–Ω–Ω—è:**
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ webhook endpoint
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ —ñ—Å–Ω—É—î —Ç–∞–±–ª–∏—Ü—è `randomizer_attempts`
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —ñ—Å–Ω—É—î –≤ –ë–î

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–º–∏–ª–∫–∞ "authOptions is not exported"
**–†—ñ—à–µ–Ω–Ω—è:** –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `@/lib/auth`

## üöÄ Production deployment

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω –¥–µ–ø–ª–æ—é –Ω–∞ Vercel:

1. –î–æ–¥–∞–π—Ç–µ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è –≤ Vercel Dashboard:
   ```
   MONOBANK_API_TOKEN=your_token
   MONOBANK_WEBHOOK_URL=https://your-domain.vercel.app/api/payments/mono/webhook
   ```

2. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ webhook URL –≤ Monobank –Ω–∞ –≤–∞—à production –¥–æ–º–µ–Ω

3. –î–µ–ø–ª–æ–π—Ç–µ:
   ```bash
   git push
   ```

## üìû –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è Monobank API](https://api.monobank.ua/docs/)
- [Prisma Docs](https://www.prisma.io/docs)
- [Next.js API Routes](https://nextjs.org/docs/api-routes/introduction)

---

**–ì–æ—Ç–æ–≤–æ! üéâ –¢–µ–ø–µ—Ä –º–æ–∂–Ω–∞ –ø—Ä–∏–π–º–∞—Ç–∏ –ø–ª–∞—Ç–µ–∂—ñ —á–µ—Ä–µ–∑ Monobank!**

